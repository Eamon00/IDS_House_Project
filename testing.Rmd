---
title: "Untitled"
author: "eamon"
date: "2025-10-17"
output: html_document
---

```{r setup, include=FALSE}
library(readr)
library(tidyverse)
library(ggplot2)
house_prices <- read_csv("data/train.csv")

summary(house_prices)

```

# Cleaning done so far:
## • TotalBath = combination of all baths.
## • Kitchen Qual = changed to numerical values.
## • Extr Qual // 5
## • Pool area: if N/A -> 0
## • Paved drive -> changed to yes = 1


## R Markdown.

## Including Plots

```{r}
house_prices_sel <- house_prices %>% 
  mutate(TotalBath = BsmtFullBath + 
           BsmtHalfBath + 
           HalfBath + 
           FullBath) %>% 
  select(Id,GarageType,BedroomAbvGr,TotalBath, BldgType, LotArea, Neighborhood, KitchenQual,PavedDrive, PoolArea, HeatingQC, TotalBsmtSF, Electrical, OverallQual,ExterQual, YearBuilt, SalePrice) %>% 
  arrange(SalePrice)


# Distribution of SalePrice
ggplot(house_prices_sel, aes(x = SalePrice)) +
  geom_histogram(bins = 30, fill = "skyblue", color = "black") +
  labs(title = "Distribution of House Prices")

library(corrplot)

# Select numeric columns
num_df <- house_prices_sel %>% select(where(is.numeric))

# Compute correlation
corr <- cor(num_df, use = "complete.obs")

# Plot correlation matrix
corrplot(corr, method = "color", type = "upper", tl.cex = 0.8)


```
```{r}
# Cleaning Data

qual_map <- c("Ex" = 5,
              "Gd" = 4,
              "TA" = 3,
              "Fa" = 2,
              "Po" = 1)


# Apply mapping
house_prices_sel$KitchenQual <- qual_map[house_prices_sel$KitchenQual]
house_prices_sel$ExterQual <- qual_map[house_prices_sel$ExterQual]
house_prices_sel$HeatingQC <- qual_map[house_prices_sel$HeatingQC]
house_prices_sel$HeatingQC <- qual_map[house_prices_sel$HeatingQC]








```
```{r}
# Load ggplot2
library(ggplot2)

# Fit linear regression
model_lm <- lm(SalePrice ~ ., data = house_prices_sel)

# Predict
pred <- predict(model_lm, newdata = house_prices_sel)

# Create a data frame for plotting
plot_data <- data.frame(
  Actual = house_prices_sel$SalePrice,
  Predicted = pred
)

# Scatter plot of Actual vs Predicted
ggplot(plot_data, aes(x = Actual, y = Predicted)) +
  geom_point(color = "blue", alpha = 0.6) +   # points
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") + # perfect prediction line
  labs(title = "Predicted vs Actual SalePrice",
       x = "Actual SalePrice",
       y = "Predicted SalePrice") +
  theme_minimal()



```
```{r}


library(ggplot2)
library(dplyr)
library(purrr)
library(tidyr)


# Remove Id column from predictors
house_data <- selected_var %>% select(-Id)

all_predictors <- setdiff(names(house_data), "SalePrice")

predictor_sets <- combn(all_predictors, 12, simplify = FALSE)

results <- list()
plot_list <- list()

for (i in seq_along(predictor_sets)) {
  
  preds <- predictor_sets[[i]]
  
  # Build formula
  form <- as.formula(
    paste("SalePrice ~", paste(preds, collapse = " + "))
  )
  
  model <- lm(form, data = house_data)
  pred <- predict(model, newdata = house_data)
  r2 <- summary(model)$r.squared
  
  # Save results
  results[[i]] <- list(
    predictors = preds,
    r2 = r2,
    model = model
  )
  
  # Residual plot
  resid_plot <- ggplot(
    data.frame(Residuals = model$residuals, Fitted = model$fitted.values),
    aes(x = Fitted, y = Residuals)
  ) +
    geom_point(alpha = 0.6) +
    geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
    labs(
      title = paste("Residual Plot for Model", i),
      subtitle = paste("Predictors:", paste(preds, collapse = ", ")),
      x = "Fitted Values",
      y = "Residuals"
    ) +
    theme_minimal()
  
  plot_list[[i]] <- resid_plot
  
  # Print progress
  message("Completed model ", i, " / ", length(predictor_sets), "   R2 = ", round(r2, 4))
}

# Find the best model
best_index <- which.max(map_dbl(results, "r2"))
best_model_info <- results[[best_index]]

cat("Best model is model", best_index, "\n")
cat("R² =", best_model_info$r2, "\n")
cat("Predictors used:\n")
print(best_model_info$predictors)

# Display the residual plot for the best model
plot_list[[best_index]]

# Best model predictions
best_model <- best_model_info$model
best_predictions <- predict(best_model, newdata = house_data)

mae <- mean(abs(house_data$SalePrice - best_predictions))
cat("MAE =", round(mae, 4), "\n")

pred_vs_actual_plot <- ggplot(
  data.frame(
    Actual = house_data$SalePrice,
    Predicted = best_predictions
  ),
  aes(x = Actual, y = Predicted)
) +
  geom_point(alpha = 0.6) +
  geom_abline(intercept = 0, slope = 1, linetype = "dashed") +
  labs(
    title = paste("Predicted vs Actual SalePrice (Best Model:", best_index, ")"),
    subtitle = paste("R² =", round(best_model_info$r2, 4), "   |   MAE =", round(mae, 2)),
    x = "Actual SalePrice",
    y = "Predicted SalePrice"
  ) +
  theme_minimal()

print(pred_vs_actual_plot)

# Use the best model to generate final predictions
final_model <- best_model

final_predictions <- predict(final_model, newdata = house_data)

output_df <- data.frame(
  Id = house_prices_filtered$Id,
  Actual_SalePrice = house_prices_sel$SalePrice,
  Predicted_SalePrice = final_predictions
)

# Save to CSV
write.csv(output_df, "final_predictions.csv", row.names = FALSE)

cat("Final predictions saved to final_predictions.csv\n")








```


